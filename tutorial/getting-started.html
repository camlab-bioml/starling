<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting started with Starling (ST) &mdash; Starling  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=6916c06d" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Starling Class (ST)" href="../starling.html" />
    <link rel="prev" title="Tutorials" href="../tutorials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Starling
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting started with Starling (ST)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-seed-for-everything">Setting seed for everything</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-anndata-objects">Loading annData objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-initializations">Setting initializations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-trainning-log">Setting trainning log</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-early-stopping-criterion">Setting early stopping criterion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-starling">Training Starling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appending-starling-results-to-anndata-object">Appending STARLING results to annData object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-following-information-can-be-retrived-from-anndata-object">The following information can be retrived from annData object:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#saving-the-model">Saving the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#showing-starling-results">Showing STARLING results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#showing-initial-expression-centriods">Showing initial expression centriods:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#showing-starling-expression-centriods">Showing Starling expression centriods:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#showing-assignment-distributions">Showing Assignment Distributions:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../starling.html">Starling Class (ST)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utility.html">starling.utility</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Starling</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Getting started with Starling (ST)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/getting-started.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started-with-starling-st">
<h1>Getting started with Starling (ST)<a class="headerlink" href="#getting-started-with-starling-st" title="Link to this heading">ÔÉÅ</a></h1>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install biostarling
<span class="o">%</span><span class="k">pip</span> install lightning_lite

<span class="kn">import</span> <span class="nn">anndata</span> <span class="k">as</span> <span class="nn">ad</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">starling</span> <span class="kn">import</span> <span class="n">starling</span><span class="p">,</span> <span class="n">utility</span>
<span class="kn">from</span> <span class="nn">lightning_lite</span> <span class="kn">import</span> <span class="n">seed_everything</span>
<span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: biostarling in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (0.1.1)
Requirement already satisfied: flowsom&lt;0.2.0,&gt;=0.1.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from biostarling) (0.1.1)
Requirement already satisfied: numpy&lt;2.0,&gt;=1.26 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from biostarling) (1.26.4)
Requirement already satisfied: phenograph&lt;2.0.0,&gt;=1.5.7 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from biostarling) (1.5.7)
Requirement already satisfied: pytorch-lightning==2.1.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from biostarling) (2.1.0)
Requirement already satisfied: scanpy==1.9.5 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from biostarling) (1.9.5)
Requirement already satisfied: torch==1.12.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from biostarling) (1.12.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: tqdm&gt;=4.57.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pytorch-lightning==2.1.0-&gt;biostarling) (4.66.4)
Requirement already satisfied: PyYAML&gt;=5.4 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pytorch-lightning==2.1.0-&gt;biostarling) (6.0.1)
Requirement already satisfied: fsspec&gt;2021.06.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (2024.6.0)
Requirement already satisfied: torchmetrics&gt;=0.7.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pytorch-lightning==2.1.0-&gt;biostarling) (1.4.0.post0)
Requirement already satisfied: packaging&gt;=20.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pytorch-lightning==2.1.0-&gt;biostarling) (24.1)
Requirement already satisfied: typing-extensions&gt;=4.0.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pytorch-lightning==2.1.0-&gt;biostarling) (4.12.2)
Requirement already satisfied: lightning-utilities&gt;=0.8.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pytorch-lightning==2.1.0-&gt;biostarling) (0.11.2)
Requirement already satisfied: anndata&gt;=0.7.4 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (0.10.7)
Requirement already satisfied: matplotlib&gt;=3.4 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (3.9.0)
Requirement already satisfied: pandas&gt;=1.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (2.2.2)
Requirement already satisfied: scipy&gt;=1.4 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (1.13.1)
Requirement already satisfied: seaborn in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (0.13.2)
Requirement already satisfied: h5py&gt;=3 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (3.11.0)
Requirement already satisfied: scikit-learn&gt;=0.24 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (1.5.0)
Requirement already satisfied: statsmodels&gt;=0.10.0rc2 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (0.14.2)
Requirement already satisfied: patsy in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (0.5.6)
Requirement already satisfied: networkx&gt;=2.3 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (3.2.1)
Requirement already satisfied: natsort in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (8.4.0)
Requirement already satisfied: joblib in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (1.4.2)
Requirement already satisfied: numba&gt;=0.41.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (0.60.0)
Requirement already satisfied: umap-learn&gt;=0.3.10 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (0.5.6)
Requirement already satisfied: session-info in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scanpy==1.9.5-&gt;biostarling) (1.0.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: FlowCytometryTools in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from flowsom&lt;0.2.0,&gt;=0.1.1-&gt;biostarling) (0.5.1)
Requirement already satisfied: minisom in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from flowsom&lt;0.2.0,&gt;=0.1.1-&gt;biostarling) (2.3.2)
Requirement already satisfied: leidenalg&gt;=0.8.2 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from phenograph&lt;2.0.0,&gt;=1.5.7-&gt;biostarling) (0.10.2)
Requirement already satisfied: setuptools&gt;=18.0.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from phenograph&lt;2.0.0,&gt;=1.5.7-&gt;biostarling) (70.0.0)
Requirement already satisfied: psutil&gt;4 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from phenograph&lt;2.0.0,&gt;=1.5.7-&gt;biostarling) (5.9.8)
Requirement already satisfied: array-api-compat!=1.5,&gt;1.4 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from anndata&gt;=0.7.4-&gt;scanpy==1.9.5-&gt;biostarling) (1.7.1)
Requirement already satisfied: exceptiongroup in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from anndata&gt;=0.7.4-&gt;scanpy==1.9.5-&gt;biostarling) (1.2.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (3.9.5)
Requirement already satisfied: igraph&lt;0.12,&gt;=0.10.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from leidenalg&gt;=0.8.2-&gt;phenograph&lt;2.0.0,&gt;=1.5.7-&gt;biostarling) (0.11.5)
Requirement already satisfied: contourpy&gt;=1.0.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (1.2.1)
Requirement already satisfied: cycler&gt;=0.10 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (4.53.0)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (1.4.5)
Requirement already satisfied: pillow&gt;=8 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (10.3.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (3.1.2)
Requirement already satisfied: python-dateutil&gt;=2.7 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (2.9.0.post0)
Requirement already satisfied: importlib-resources&gt;=3.2.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (6.4.0)
Requirement already satisfied: llvmlite&lt;0.44,&gt;=0.43.0dev0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from numba&gt;=0.41.0-&gt;scanpy==1.9.5-&gt;biostarling) (0.43.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytz&gt;=2020.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pandas&gt;=1.0-&gt;scanpy==1.9.5-&gt;biostarling) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from pandas&gt;=1.0-&gt;scanpy==1.9.5-&gt;biostarling) (2024.1)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from scikit-learn&gt;=0.24-&gt;scanpy==1.9.5-&gt;biostarling) (3.5.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: six in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from patsy-&gt;scanpy==1.9.5-&gt;biostarling) (1.16.0)
Requirement already satisfied: pynndescent&gt;=0.5 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from umap-learn&gt;=0.3.10-&gt;scanpy==1.9.5-&gt;biostarling) (0.5.13)
Requirement already satisfied: decorator in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from FlowCytometryTools-&gt;flowsom&lt;0.2.0,&gt;=0.1.1-&gt;biostarling) (5.1.1)
Requirement already satisfied: fcsparser&gt;=0.1.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from FlowCytometryTools-&gt;flowsom&lt;0.2.0,&gt;=0.1.1-&gt;biostarling) (0.2.8)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: stdlib-list in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from session-info-&gt;scanpy==1.9.5-&gt;biostarling) (0.10.0)
Requirement already satisfied: aiosignal&gt;=1.1.2 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (1.3.1)
Requirement already satisfied: attrs&gt;=17.3.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (23.2.0)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (1.4.1)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (6.0.5)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (1.9.4)
Requirement already satisfied: async-timeout&lt;5.0,&gt;=4.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (4.0.3)
Requirement already satisfied: texttable&gt;=1.6.2 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from igraph&lt;0.12,&gt;=0.10.0-&gt;leidenalg&gt;=0.8.2-&gt;phenograph&lt;2.0.0,&gt;=1.5.7-&gt;biostarling) (1.7.0)
Requirement already satisfied: zipp&gt;=3.1.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from importlib-resources&gt;=3.2.0-&gt;matplotlib&gt;=3.4-&gt;scanpy==1.9.5-&gt;biostarling) (3.19.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: idna&gt;=2.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from yarl&lt;2.0,&gt;=1.0-&gt;aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;pytorch-lightning==2.1.0-&gt;biostarling) (3.7)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> A new release of pip is available: <span class=" -Color -Color-Red">24.1</span> -&gt; <span class=" -Color -Color-Green">24.1.1</span>
<span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> To update, run: <span class=" -Color -Color-Green">pip install --upgrade pip</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: lightning_lite in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (1.8.6)
Requirement already satisfied: numpy&gt;=1.17.2 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from lightning_lite) (1.26.4)
Requirement already satisfied: torch&gt;=1.9.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from lightning_lite) (1.12.1)
Requirement already satisfied: fsspec&gt;2021.06.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (2024.6.0)
Requirement already satisfied: packaging&gt;=17.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from lightning_lite) (24.1)
Requirement already satisfied: typing-extensions&gt;=4.0.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from lightning_lite) (4.12.2)
Requirement already satisfied: lightning-utilities!=0.4.0,&gt;=0.3.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from lightning_lite) (0.11.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (3.9.5)
Requirement already satisfied: setuptools in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from lightning-utilities!=0.4.0,&gt;=0.3.0-&gt;lightning_lite) (70.0.0)
Requirement already satisfied: aiosignal&gt;=1.1.2 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (1.3.1)
Requirement already satisfied: attrs&gt;=17.3.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (23.2.0)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (1.4.1)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (6.0.5)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (1.9.4)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: async-timeout&lt;5.0,&gt;=4.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (4.0.3)
Requirement already satisfied: idna&gt;=2.0 in /home/runner/work/starling/starling/.venv/lib/python3.9/site-packages (from yarl&lt;2.0,&gt;=1.0-&gt;aiohttp!=4.0.0a0,!=4.0.0a1-&gt;fsspec[http]&gt;2021.06.0-&gt;lightning_lite) (3.7)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> A new release of pip is available: <span class=" -Color -Color-Red">24.1</span> -&gt; <span class=" -Color -Color-Green">24.1.1</span>
<span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> To update, run: <span class=" -Color -Color-Green">pip install --upgrade pip</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/starling/starling/.venv/lib/python3.9/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</details>
</div>
<section id="setting-seed-for-everything">
<h2>Setting seed for everything<a class="headerlink" href="#setting-seed-for-everything" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pl.utilities.seed.seed_everything(10, workers=True)</span>
<span class="n">seed_everything</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Global seed set to 10
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="loading-anndata-objects">
<h2>Loading annData objects<a class="headerlink" href="#loading-anndata-objects" title="Link to this heading">ÔÉÅ</a></h2>
<p>The example below runs Kmeans with 10 clusters read from ‚Äúsample_input.h5ad‚Äù object.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>https://github.com/camlab-bioml/starling/raw/main/docs/source/tutorial/sample_input.h5ad

<span class="n">adata</span> <span class="o">=</span> <span class="n">utility</span><span class="o">.</span><span class="n">init_clustering</span><span class="p">(</span><span class="s2">&quot;KM&quot;</span><span class="p">,</span> <span class="n">ad</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="s2">&quot;sample_input.h5ad&quot;</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2024-07-05 13:26:58--  https://github.com/camlab-bioml/starling/raw/main/docs/source/tutorial/sample_input.h5ad
Resolving github.com (github.com)... 140.82.116.3
Connecting to github.com (github.com)|140.82.116.3|:443... connected.
HTTP request sent, awaiting response... 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>302 Found
Location: https://raw.githubusercontent.com/camlab-bioml/starling/main/docs/source/tutorial/sample_input.h5ad [following]
--2024-07-05 13:26:58--  https://raw.githubusercontent.com/camlab-bioml/starling/main/docs/source/tutorial/sample_input.h5ad
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.111.133, 185.199.109.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HTTP request sent, awaiting response... 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200 OK
Length: 2639432 (2.5M) [application/octet-stream]
Saving to: ‚Äòsample_input.h5ad.1‚Äô


sample_input.h5ad.1   0%[                    ]       0  --.-KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sample_input.h5ad.1 100%[===================&gt;]   2.52M  --.-KB/s    in 0.01s   

2024-07-05 13:26:59 (214 MB/s) - ‚Äòsample_input.h5ad.1‚Äô saved [2639432/2639432]
</pre></div>
</div>
</div>
</details>
</div>
<ul class="simple">
<li><p>Users might want to arcsinh protein expressions in *.h5ad (for example, ‚Äòsample_input.h5ad‚Äô).</p></li>
<li><p>The utility.py provides an easy setup of GMM, KM (Kmeans) or PG (PhenoGraph).</p></li>
<li><p>Default settings are applied to each method.</p></li>
<li><p>k can be omitted when PG is used.</p></li>
</ul>
</section>
<section id="setting-initializations">
<h2>Setting initializations<a class="headerlink" href="#setting-initializations" title="Link to this heading">ÔÉÅ</a></h2>
<p>The example below uses defualt parameter settings based on benchmarking results (more details in manuscript).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">st</span> <span class="o">=</span> <span class="n">starling</span><span class="o">.</span><span class="n">ST</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/starling/starling/starling/starling.py:78: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  torch.tensor(self.adata.obs[self.cell_size_col_name])
</pre></div>
</div>
</div>
</div>
<p>A list of parameters are shown:</p>
<ul class="simple">
<li><p>adata: annDATA object of the sample</p></li>
<li><p>dist_option (default: ‚ÄòT‚Äô): T for Student-T (df=2) and N for Normal (Gaussian)</p></li>
<li><p>the proportion of anticipated segmentation error free cells (default: 0.6)</p></li>
<li><p>model_cell_size (default: ‚ÄòY‚Äô): Y for incoporating cell size in the model and N otherwise</p></li>
<li><p>cell_size_col_name (default: ‚Äòarea‚Äô): area is the column name in anndata.obs dataframe</p></li>
<li><p>model_zplane_overlap (default: ‚ÄòY‚Äô): Y for modeling z-plane overlap when cell size is modelled and N otherwise
Note: if the user sets model_cell_size = ‚ÄòN‚Äô, then model_zplane_overlap is ignored</p></li>
<li><p>model_regularizer (default: 1): Regularizier term impose on synthetic doublet loss (BCE)</p></li>
<li><p>learning_rate (default: 1e-3): The learning rate of ADAM optimizer for STARLING</p></li>
</ul>
<p>Equivalent as the above example:
st = starling.ST(adata, ‚ÄòT‚Äô, ‚ÄòY‚Äô, ‚Äòarea‚Äô, ‚ÄòY‚Äô, 1, 1e-3)</p>
</section>
<section id="setting-trainning-log">
<h2>Setting trainning log<a class="headerlink" href="#setting-trainning-log" title="Link to this heading">ÔÉÅ</a></h2>
<p>Once training starts, a new directory ‚Äòlog‚Äô will created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## log training results via tensorboard</span>
<span class="n">log_tb</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">TensorBoardLogger</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">## log training results via tensorboard</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">log_tb</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">TensorBoardLogger</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="ne">AttributeError</span>: module &#39;logging&#39; has no attribute &#39;TensorBoardLogger&#39;
</pre></div>
</div>
</div>
</div>
<p>One could view the training information via tensorboard. Please refer to torch lightning (https://lightning.ai/docs/pytorch/stable/api_references.html#profiler) for other possible loggers.</p>
</section>
<section id="setting-early-stopping-criterion">
<h2>Setting early stopping criterion<a class="headerlink" href="#setting-early-stopping-criterion" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## set early stopping criterion</span>
<span class="n">cb_early_stopping</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;train_loss&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Training loss is monitored.</p>
</section>
<section id="training-starling">
<h2>Training Starling<a class="headerlink" href="#training-starling" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## train ST</span>
<span class="n">st</span><span class="o">.</span><span class="n">train_and_fit</span><span class="p">(</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">cb_early_stopping</span><span class="p">],</span>
    <span class="c1">#logger=[log_tb],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="appending-starling-results-to-anndata-object">
<h2>Appending STARLING results to annData object<a class="headerlink" href="#appending-starling-results-to-anndata-object" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## retrive starling results</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-following-information-can-be-retrived-from-anndata-object">
<h2>The following information can be retrived from annData object:<a class="headerlink" href="#the-following-information-can-be-retrived-from-anndata-object" title="Link to this heading">ÔÉÅ</a></h2>
<ul class="simple">
<li><p>st.adata.varm[‚Äòinit_exp_centroids‚Äô] ‚Äì initial expression cluster centroids (P x C matrix)</p></li>
<li><p>st.adata.varm[‚Äòst_exp_centroids‚Äô] ‚Äì ST expression cluster centroids (P x C matrix)</p></li>
<li><p>st.adata.uns[‚Äòinit_cell_size_centroids‚Äô] ‚Äì initial cell size centroids if STARLING models cell size</p></li>
<li><p>st.adata.uns[‚Äòst_cell_size_centroids‚Äô] ‚Äì initial &amp; ST cell size centroids if ST models cell size</p></li>
<li><p>st.adata.obsm[‚Äòassignment_prob_matrix‚Äô] ‚Äì cell assignment probability (N x C maxtrix)</p></li>
<li><p>st.adata.obsm[‚Äògamma_prob_matrix‚Äô] ‚Äì gamma probabilitiy of two cells (N x C x C maxtrix)</p></li>
<li><p>st.adata.obs[‚Äòdoublet‚Äô] ‚Äì doublet indicator</p></li>
<li><p>st.adata.obs[‚Äòdoublet_prob‚Äô] ‚Äì doublet probabilities</p></li>
<li><p>st.adata.obs[‚Äòinit_label‚Äô] ‚Äì initial assignments</p></li>
<li><p>st.adata.obs[‚Äòst_label‚Äô] ‚Äì ST assignments</p></li>
<li><p>st.adata.obs[‚Äòmax_assign_prob‚Äô] ‚Äì ST max probabilites of assignments</p>
<ul>
<li><p>N: # of cells; C: # of clusters; P: # of proteins</p></li>
</ul>
</li>
</ul>
</section>
<section id="saving-the-model">
<h2>Saving the model<a class="headerlink" href="#saving-the-model" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## st object can be saved</span>
<span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="s2">&quot;model.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>model.pt will be saved in the same directory as this notebook.</p>
</section>
<section id="showing-starling-results">
<h2>Showing STARLING results<a class="headerlink" href="#showing-starling-results" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>One could easily perform further analysis such as co-occurance, enrichment analysis and etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">obs</span>
</pre></div>
</div>
</div>
</div>
<p>Starling provides doublet probabilities and cell assignment if it were a singlet for each cell.</p>
</section>
<section id="showing-initial-expression-centriods">
<h2>Showing initial expression centriods:<a class="headerlink" href="#showing-initial-expression-centriods" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## initial expression centriods (p x c) matrix</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">varm</span><span class="p">[</span><span class="s2">&quot;init_exp_centroids&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are 10 centroids since we set Kmeans (KM) as k = 10 earlier.</p>
</section>
<section id="showing-starling-expression-centriods">
<h2>Showing Starling expression centriods:<a class="headerlink" href="#showing-starling-expression-centriods" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## starling expression centriods (p x c) matrix</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">varm</span><span class="p">[</span><span class="s2">&quot;st_exp_centroids&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From here one could easily annotate cluster centriods to cell type.</p>
</section>
<section id="showing-assignment-distributions">
<h2>Showing Assignment Distributions:<a class="headerlink" href="#showing-assignment-distributions" title="Link to this heading">ÔÉÅ</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## assignment distributions (n x c maxtrix)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;assignment_prob_matrix&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Currently, we assign a cell label based on the maximum probability among all possible clusters. However, there could be mislabeled because maximum and second highest probabilies can be very close that the user might be interested.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../tutorials.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../starling.html" class="btn btn-neutral float-right" title="Starling Class (ST)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, contribs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>