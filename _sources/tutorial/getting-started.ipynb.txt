{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "b3e79fa9",
   "metadata": {},
   "source": [
    "# Getting started with Starling (ST)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "2a06e71b",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/poetry-env/lib/python3.9/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n",
      "  from .autonotebook import tqdm as notebook_tqdm\n"
     ]
    }
   ],
   "source": [
    "%pip install https://github.com/camlab-bioml/starling/archive/main.zip\n",
    "%pip install lightning_lite\n",
    "\n",
    "import anndata as ad\n",
    "import pandas as pd\n",
    "import pytorch_lightning as pl\n",
    "import torch\n",
    "from lightning_lite import seed_everything\n",
    "from pytorch_lightning.callbacks import EarlyStopping  # ModelCheckpoint\n",
    "from pytorch_lightning.loggers import TensorBoardLogger\n",
    "\n",
    "from starling import starling, utility\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b615eb39",
   "metadata": {},
   "source": [
    "## Setting seed for everything\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "e83f4cce",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Global seed set to 10\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "10"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# pl.utilities.seed.seed_everything(10, workers=True)\n",
    "seed_everything(10, workers=True)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d1f5142d",
   "metadata": {},
   "source": [
    "## Loading annData objects\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "69ef8c1d",
   "metadata": {},
   "source": [
    "The example below runs Kmeans with 10 clusters read from \"sample_input.h5ad\" object.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "8c4a203f",
   "metadata": {},
   "outputs": [
    {
     "ename": "NotImplementedError",
     "evalue": "Equality comparisons are not supported for AnnData objects, instead compare the desired attributes.",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mNotImplementedError\u001b[0m                       Traceback (most recent call last)",
      "\u001b[1;32m/code/docs/source/tutorial/getting-started.ipynb Cell 7\u001b[0m line \u001b[0;36m1\n\u001b[0;32m----> <a href='vscode-notebook-cell://attached-container%2B7b22636f6e7461696e65724e616d65223a222f6578636974696e675f73686f636b6c6579227d/code/docs/source/tutorial/getting-started.ipynb#W6sdnNjb2RlLXJlbW90ZQ%3D%3D?line=0'>1</a>\u001b[0m adata \u001b[39m=\u001b[39m utility\u001b[39m.\u001b[39;49minit_clustering(ad\u001b[39m.\u001b[39;49mread_h5ad(\u001b[39m\"\u001b[39;49m\u001b[39msample_input.h5ad\u001b[39;49m\u001b[39m\"\u001b[39;49m), \u001b[39m\"\u001b[39;49m\u001b[39mKM\u001b[39;49m\u001b[39m\"\u001b[39;49m, k\u001b[39m=\u001b[39;49m\u001b[39m10\u001b[39;49m)\n",
      "File \u001b[0;32m/code/starling/utility.py:60\u001b[0m, in \u001b[0;36minit_clustering\u001b[0;34m(initial_clustering_method, adata, k, labels, centroids, variances)\u001b[0m\n\u001b[1;32m     34\u001b[0m \u001b[39mdef\u001b[39;00m \u001b[39minit_clustering\u001b[39m(\n\u001b[1;32m     35\u001b[0m     initial_clustering_method: Literal[\u001b[39m\"\u001b[39m\u001b[39mUser\u001b[39m\u001b[39m\"\u001b[39m, \u001b[39m\"\u001b[39m\u001b[39mKM\u001b[39m\u001b[39m\"\u001b[39m, \u001b[39m\"\u001b[39m\u001b[39mGMM\u001b[39m\u001b[39m\"\u001b[39m, \u001b[39m\"\u001b[39m\u001b[39mFS\u001b[39m\u001b[39m\"\u001b[39m, \u001b[39m\"\u001b[39m\u001b[39mPG\u001b[39m\u001b[39m\"\u001b[39m],\n\u001b[1;32m     36\u001b[0m     adata: AnnData,\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m     40\u001b[0m     variances\u001b[39m=\u001b[39m\u001b[39mNone\u001b[39;00m,\n\u001b[1;32m     41\u001b[0m ) \u001b[39m-\u001b[39m\u001b[39m>\u001b[39m AnnData:\n\u001b[1;32m     42\u001b[0m \u001b[39m    \u001b[39m\u001b[39m\"\"\"Compute initial cluster centroids, variances & labels\u001b[39;00m\n\u001b[1;32m     43\u001b[0m \n\u001b[1;32m     44\u001b[0m \u001b[39m    :param adata: The initial data to be analyzed\u001b[39;00m\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m     57\u001b[0m \u001b[39m    :rtype: AnnData\u001b[39;00m\n\u001b[1;32m     58\u001b[0m \u001b[39m    \"\"\"\u001b[39;00m\n\u001b[0;32m---> 60\u001b[0m     \u001b[39mif\u001b[39;00m initial_clustering_method \u001b[39mnot\u001b[39;49;00m \u001b[39min\u001b[39;49;00m [\u001b[39m\"\u001b[39;49m\u001b[39mKM\u001b[39;49m\u001b[39m\"\u001b[39;49m, \u001b[39m\"\u001b[39;49m\u001b[39mGMM\u001b[39;49m\u001b[39m\"\u001b[39;49m, \u001b[39m\"\u001b[39;49m\u001b[39mFS\u001b[39;49m\u001b[39m\"\u001b[39;49m, \u001b[39m\"\u001b[39;49m\u001b[39mPG\u001b[39;49m\u001b[39m\"\u001b[39;49m, \u001b[39m\"\u001b[39;49m\u001b[39mUser\u001b[39;49m\u001b[39m\"\u001b[39;49m]:\n\u001b[1;32m     61\u001b[0m         \u001b[39mraise\u001b[39;00m \u001b[39mValueError\u001b[39;00m(\n\u001b[1;32m     62\u001b[0m             \u001b[39m'\u001b[39m\u001b[39minitial_clustering_method must be one of \u001b[39m\u001b[39m\"\u001b[39m\u001b[39mKM\u001b[39m\u001b[39m\"\u001b[39m\u001b[39m,\u001b[39m\u001b[39m\"\u001b[39m\u001b[39mGMM\u001b[39m\u001b[39m\"\u001b[39m\u001b[39m,\u001b[39m\u001b[39m\"\u001b[39m\u001b[39mFS\u001b[39m\u001b[39m\"\u001b[39m\u001b[39m,\u001b[39m\u001b[39m\"\u001b[39m\u001b[39mPG\u001b[39m\u001b[39m\"\u001b[39m\u001b[39m or \u001b[39m\u001b[39m\"\u001b[39m\u001b[39mUser\u001b[39m\u001b[39m\"\u001b[39m\u001b[39m defined cluster centroids/variances\u001b[39m\u001b[39m'\u001b[39m\n\u001b[1;32m     63\u001b[0m         )\n\u001b[1;32m     65\u001b[0m     \u001b[39mif\u001b[39;00m initial_clustering_method \u001b[39min\u001b[39;00m [\u001b[39m\"\u001b[39m\u001b[39mKM\u001b[39m\u001b[39m\"\u001b[39m, \u001b[39m\"\u001b[39m\u001b[39mGMM\u001b[39m\u001b[39m\"\u001b[39m, \u001b[39m\"\u001b[39m\u001b[39mFS\u001b[39m\u001b[39m\"\u001b[39m] \u001b[39mand\u001b[39;00m k \u001b[39mis\u001b[39;00m \u001b[39mNone\u001b[39;00m:\n",
      "File \u001b[0;32m/poetry-env/lib/python3.9/site-packages/anndata/_core/anndata.py:656\u001b[0m, in \u001b[0;36mAnnData.__eq__\u001b[0;34m(self, other)\u001b[0m\n\u001b[1;32m    654\u001b[0m \u001b[39mdef\u001b[39;00m \u001b[39m__eq__\u001b[39m(\u001b[39mself\u001b[39m, other):\n\u001b[1;32m    655\u001b[0m \u001b[39m    \u001b[39m\u001b[39m\"\"\"Equality testing\"\"\"\u001b[39;00m\n\u001b[0;32m--> 656\u001b[0m     \u001b[39mraise\u001b[39;00m \u001b[39mNotImplementedError\u001b[39;00m(\n\u001b[1;32m    657\u001b[0m         \u001b[39m\"\u001b[39m\u001b[39mEquality comparisons are not supported for AnnData objects, \u001b[39m\u001b[39m\"\u001b[39m\n\u001b[1;32m    658\u001b[0m         \u001b[39m\"\u001b[39m\u001b[39minstead compare the desired attributes.\u001b[39m\u001b[39m\"\u001b[39m\n\u001b[1;32m    659\u001b[0m     )\n",
      "\u001b[0;31mNotImplementedError\u001b[0m: Equality comparisons are not supported for AnnData objects, instead compare the desired attributes."
     ]
    }
   ],
   "source": [
    "!wget https://github.com/camlab-bioml/starling/raw/main/docs/source/tutorial/sample_input.h5ad\n",
    "\n",
    "adata = utility.init_clustering(\"KM\", ad.read_h5ad(\"sample_input.h5ad\"), k=10)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "52d3d9fb",
   "metadata": {},
   "source": [
    "- Users might want to arcsinh protein expressions in \\*.h5ad (for example, 'sample_input.h5ad').\n",
    "- The utility.py provides an easy setup of GMM, KM (Kmeans) or PG (PhenoGraph).\n",
    "- Default settings are applied to each method.\n",
    "- k can be omitted when PG is used.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7fd11c15",
   "metadata": {},
   "source": [
    "## Setting initializations\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6effd2b9",
   "metadata": {},
   "source": [
    "The example below uses defualt parameter settings based on benchmarking results (more details in manuscript).\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "eff9a063",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/code/starling/starling.py:73: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`\n",
      "  torch.tensor(self.adata.obs[self.cell_size_col_name])\n"
     ]
    }
   ],
   "source": [
    "st = starling.ST(adata)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "923d2e71",
   "metadata": {},
   "source": [
    "A list of parameters are shown:\n",
    "\n",
    "- adata: annDATA object of the sample\n",
    "- dist_option (default: 'T'): T for Student-T (df=2) and N for Normal (Gaussian)\n",
    "- the proportion of anticipated segmentation error free cells (default: 0.6)\n",
    "- model_cell_size (default: 'Y'): Y for incoporating cell size in the model and N otherwise\n",
    "- cell_size_col_name (default: 'area'): area is the column name in anndata.obs dataframe\n",
    "- model_zplane_overlap (default: 'Y'): Y for modeling z-plane overlap when cell size is modelled and N otherwise\n",
    "  Note: if the user sets model_cell_size = 'N', then model_zplane_overlap is ignored\n",
    "- model_regularizer (default: 1): Regularizier term impose on synthetic doublet loss (BCE)\n",
    "- learning_rate (default: 1e-3): The learning rate of ADAM optimizer for STARLING\n",
    "\n",
    "Equivalent as the above example:\n",
    "st = starling.ST(adata, 'T', 'Y', 'area', 'Y', 1, 1e-3)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "63939215",
   "metadata": {},
   "source": [
    "## Setting trainning log\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d721258f",
   "metadata": {},
   "source": [
    "Once training starts, a new directory 'log' will created.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "a217070c",
   "metadata": {},
   "outputs": [],
   "source": [
    "## log training results via tensorboard\n",
    "log_tb = TensorBoardLogger(save_dir=\"log\")\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ae8e46ea",
   "metadata": {},
   "source": [
    "One could view the training information via tensorboard. Please refer to torch lightning (https://lightning.ai/docs/pytorch/stable/api_references.html#profiler) for other possible loggers.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "914bcd5c",
   "metadata": {},
   "source": [
    "## Setting early stopping criterion\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "90877a9c",
   "metadata": {},
   "outputs": [],
   "source": [
    "## set early stopping criterion\n",
    "cb_early_stopping = EarlyStopping(monitor=\"train_loss\", mode=\"min\", verbose=False)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ac4c7459",
   "metadata": {},
   "source": [
    "Training loss is monitored.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bb32a46b",
   "metadata": {},
   "source": [
    "## Training Starling\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "8f49c63c",
   "metadata": {
    "tags": [
     "hide-output"
    ]
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "GPU available: False, used: False\n",
      "TPU available: False, using: 0 TPU cores\n",
      "IPU available: False, using: 0 IPUs\n",
      "HPU available: False, using: 0 HPUs\n",
      "/poetry-env/lib/python3.10/site-packages/pytorch_lightning/callbacks/model_checkpoint.py:630: Checkpoint directory log/lightning_logs/version_2/checkpoints exists and is not empty.\n",
      "\n",
      "  | Name | Type | Params\n",
      "------------------------------\n",
      "------------------------------\n",
      "0         Trainable params\n",
      "0         Non-trainable params\n",
      "0         Total params\n",
      "0.000     Total estimated model params size (MB)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/poetry-env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py:293: The number of training batches (27) is smaller than the logging interval Trainer(log_every_n_steps=50). Set a lower value for log_every_n_steps if you want to see logs for the training epoch.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 2: 100%|██████████| 27/27 [00:01<00:00, 25.18it/s, v_num=2, train_loss_step=86.10, train_loss_epoch=86.80]\n"
     ]
    }
   ],
   "source": [
    "## train ST\n",
    "trainer = pl.Trainer(\n",
    "    max_epochs=100,\n",
    "    accelerator=\"auto\",\n",
    "    devices=\"auto\",\n",
    "    deterministic=True,\n",
    "    callbacks=[cb_early_stopping],\n",
    "    logger=[log_tb],\n",
    ")\n",
    "trainer.fit(st)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3ba887b2",
   "metadata": {},
   "source": [
    "## Appending STARLING results to annData object\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "3082c69a",
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "## retrive starling results\n",
    "st.result()\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a705d895",
   "metadata": {},
   "source": [
    "## The following information can be retrived from annData object:\n",
    "\n",
    "- st.adata.varm['init_exp_centroids'] -- initial expression cluster centroids (P x C matrix)\n",
    "- st.adata.varm['st_exp_centroids'] -- ST expression cluster centroids (P x C matrix)\n",
    "- st.adata.uns['init_cell_size_centroids'] -- initial cell size centroids if STARLING models cell size\n",
    "- st.adata.uns['st_cell_size_centroids'] -- initial & ST cell size centroids if ST models cell size\n",
    "- st.adata.obsm['assignment_prob_matrix'] -- cell assignment probability (N x C maxtrix)\n",
    "- st.adata.obsm['gamma_prob_matrix'] -- gamma probabilitiy of two cells (N x C x C maxtrix)\n",
    "- st.adata.obs['doublet'] -- doublet indicator\n",
    "- st.adata.obs['doublet_prob'] -- doublet probabilities\n",
    "- st.adata.obs['init_label'] -- initial assignments\n",
    "- st.adata.obs['st_label'] -- ST assignments\n",
    "- st.adata.obs['max_assign_prob'] -- ST max probabilites of assignments\n",
    "  - N: # of cells; C: # of clusters; P: # of proteins\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4ab8cb0a",
   "metadata": {},
   "source": [
    "## Saving the model\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "204cad47",
   "metadata": {},
   "outputs": [],
   "source": [
    "## st object can be saved\n",
    "torch.save(st, \"model.pt\")\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "980dad28",
   "metadata": {},
   "source": [
    "model.pt will be saved in the same directory as this notebook.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ad7e5fc0",
   "metadata": {},
   "source": [
    "## Showing STARLING results\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "c7e67d1d",
   "metadata": {
    "tags": [
     "scroll-output"
    ]
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 13685 × 24\n",
       "    obs: 'sample', 'id', 'x', 'y', 'area', 'area_convex', 'neighbor', 'init_label', 'st_label', 'doublet_prob', 'doublet', 'max_assign_prob'\n",
       "    uns: 'init_cell_size_centroids', 'init_cell_size_variances', 'st_cell_size_centroids'\n",
       "    obsm: 'assignment_prob_matrix', 'gamma_assignment_prob_matrix'\n",
       "    varm: 'init_exp_centroids', 'init_exp_variances', 'st_exp_centroids'"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "st.adata\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "53e32d26",
   "metadata": {},
   "source": [
    "One could easily perform further analysis such as co-occurance, enrichment analysis and etc.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "b601be72",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>sample</th>\n",
       "      <th>id</th>\n",
       "      <th>x</th>\n",
       "      <th>y</th>\n",
       "      <th>area</th>\n",
       "      <th>area_convex</th>\n",
       "      <th>neighbor</th>\n",
       "      <th>init_label</th>\n",
       "      <th>st_label</th>\n",
       "      <th>doublet_prob</th>\n",
       "      <th>doublet</th>\n",
       "      <th>max_assign_prob</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>4_1</th>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.785714</td>\n",
       "      <td>7.785714</td>\n",
       "      <td>14</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>7</td>\n",
       "      <td>0.068696</td>\n",
       "      <td>0</td>\n",
       "      <td>0.931299</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_2</th>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0.823529</td>\n",
       "      <td>22.294117</td>\n",
       "      <td>17</td>\n",
       "      <td>17</td>\n",
       "      <td>0</td>\n",
       "      <td>8</td>\n",
       "      <td>1</td>\n",
       "      <td>0.265032</td>\n",
       "      <td>0</td>\n",
       "      <td>0.455922</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_3</th>\n",
       "      <td>4</td>\n",
       "      <td>3</td>\n",
       "      <td>0.875000</td>\n",
       "      <td>79.500000</td>\n",
       "      <td>16</td>\n",
       "      <td>16</td>\n",
       "      <td>1</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>0.018245</td>\n",
       "      <td>0</td>\n",
       "      <td>0.981755</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_4</th>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>0.666667</td>\n",
       "      <td>270.500000</td>\n",
       "      <td>12</td>\n",
       "      <td>12</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>7</td>\n",
       "      <td>0.074352</td>\n",
       "      <td>0</td>\n",
       "      <td>0.925553</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_5</th>\n",
       "      <td>4</td>\n",
       "      <td>5</td>\n",
       "      <td>0.823529</td>\n",
       "      <td>279.294130</td>\n",
       "      <td>17</td>\n",
       "      <td>17</td>\n",
       "      <td>1</td>\n",
       "      <td>6</td>\n",
       "      <td>7</td>\n",
       "      <td>0.099415</td>\n",
       "      <td>0</td>\n",
       "      <td>0.852824</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13681</th>\n",
       "      <td>4</td>\n",
       "      <td>13681</td>\n",
       "      <td>997.769200</td>\n",
       "      <td>754.500000</td>\n",
       "      <td>26</td>\n",
       "      <td>26</td>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>0.059487</td>\n",
       "      <td>0</td>\n",
       "      <td>0.940513</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13682</th>\n",
       "      <td>4</td>\n",
       "      <td>13682</td>\n",
       "      <td>998.153900</td>\n",
       "      <td>127.615390</td>\n",
       "      <td>13</td>\n",
       "      <td>13</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>0.077304</td>\n",
       "      <td>0</td>\n",
       "      <td>0.922694</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13683</th>\n",
       "      <td>4</td>\n",
       "      <td>13683</td>\n",
       "      <td>998.153900</td>\n",
       "      <td>160.000000</td>\n",
       "      <td>13</td>\n",
       "      <td>13</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>7</td>\n",
       "      <td>0.079220</td>\n",
       "      <td>0</td>\n",
       "      <td>0.919557</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13684</th>\n",
       "      <td>4</td>\n",
       "      <td>13684</td>\n",
       "      <td>997.580600</td>\n",
       "      <td>242.580640</td>\n",
       "      <td>31</td>\n",
       "      <td>33</td>\n",
       "      <td>1</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>0.064449</td>\n",
       "      <td>0</td>\n",
       "      <td>0.935550</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13685</th>\n",
       "      <td>4</td>\n",
       "      <td>13685</td>\n",
       "      <td>997.947400</td>\n",
       "      <td>531.315800</td>\n",
       "      <td>19</td>\n",
       "      <td>19</td>\n",
       "      <td>1</td>\n",
       "      <td>8</td>\n",
       "      <td>2</td>\n",
       "      <td>0.656594</td>\n",
       "      <td>1</td>\n",
       "      <td>0.181685</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>13685 rows × 12 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "         sample     id           x           y  area  area_convex  neighbor  \\\n",
       "4_1           4      1    0.785714    7.785714    14           14         0   \n",
       "4_2           4      2    0.823529   22.294117    17           17         0   \n",
       "4_3           4      3    0.875000   79.500000    16           16         1   \n",
       "4_4           4      4    0.666667  270.500000    12           12         0   \n",
       "4_5           4      5    0.823529  279.294130    17           17         1   \n",
       "...         ...    ...         ...         ...   ...          ...       ...   \n",
       "4_13681       4  13681  997.769200  754.500000    26           26         0   \n",
       "4_13682       4  13682  998.153900  127.615390    13           13         0   \n",
       "4_13683       4  13683  998.153900  160.000000    13           13         1   \n",
       "4_13684       4  13684  997.580600  242.580640    31           33         1   \n",
       "4_13685       4  13685  997.947400  531.315800    19           19         1   \n",
       "\n",
       "         init_label  st_label  doublet_prob  doublet  max_assign_prob  \n",
       "4_1               4         7      0.068696        0         0.931299  \n",
       "4_2               8         1      0.265032        0         0.455922  \n",
       "4_3               5         2      0.018245        0         0.981755  \n",
       "4_4               0         7      0.074352        0         0.925553  \n",
       "4_5               6         7      0.099415        0         0.852824  \n",
       "...             ...       ...           ...      ...              ...  \n",
       "4_13681           6         6      0.059487        0         0.940513  \n",
       "4_13682           0         6      0.077304        0         0.922694  \n",
       "4_13683           1         7      0.079220        0         0.919557  \n",
       "4_13684           6         6      0.064449        0         0.935550  \n",
       "4_13685           8         2      0.656594        1         0.181685  \n",
       "\n",
       "[13685 rows x 12 columns]"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "st.adata.obs\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "af541283",
   "metadata": {},
   "source": [
    "Starling provides doublet probabilities and cell assignment if it were a singlet for each cell.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "80e61208",
   "metadata": {},
   "source": [
    "## Showing initial expression centriods:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "a2be0fcc",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "      <th>4</th>\n",
       "      <th>5</th>\n",
       "      <th>6</th>\n",
       "      <th>7</th>\n",
       "      <th>8</th>\n",
       "      <th>9</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>SMA</th>\n",
       "      <td>0.481423</td>\n",
       "      <td>1.309391</td>\n",
       "      <td>2.126096</td>\n",
       "      <td>0.579704</td>\n",
       "      <td>1.034955</td>\n",
       "      <td>2.213308</td>\n",
       "      <td>0.709806</td>\n",
       "      <td>1.934577</td>\n",
       "      <td>1.527963</td>\n",
       "      <td>0.709294</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ECadherin</th>\n",
       "      <td>5.337153</td>\n",
       "      <td>0.895151</td>\n",
       "      <td>0.917277</td>\n",
       "      <td>0.957158</td>\n",
       "      <td>1.015014</td>\n",
       "      <td>0.994053</td>\n",
       "      <td>2.059105</td>\n",
       "      <td>0.894870</td>\n",
       "      <td>0.895395</td>\n",
       "      <td>0.903859</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Cytokeratin</th>\n",
       "      <td>67.964310</td>\n",
       "      <td>8.256815</td>\n",
       "      <td>7.940267</td>\n",
       "      <td>12.393278</td>\n",
       "      <td>9.756522</td>\n",
       "      <td>7.235658</td>\n",
       "      <td>21.381472</td>\n",
       "      <td>8.161931</td>\n",
       "      <td>8.062714</td>\n",
       "      <td>10.285240</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>HLADR</th>\n",
       "      <td>9.514902</td>\n",
       "      <td>25.786489</td>\n",
       "      <td>19.902126</td>\n",
       "      <td>100.617966</td>\n",
       "      <td>22.652782</td>\n",
       "      <td>16.925838</td>\n",
       "      <td>31.314178</td>\n",
       "      <td>24.423939</td>\n",
       "      <td>27.201952</td>\n",
       "      <td>107.715370</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Vimentin</th>\n",
       "      <td>26.117706</td>\n",
       "      <td>288.943787</td>\n",
       "      <td>613.416626</td>\n",
       "      <td>59.960083</td>\n",
       "      <td>207.838837</td>\n",
       "      <td>854.635254</td>\n",
       "      <td>118.783218</td>\n",
       "      <td>474.137756</td>\n",
       "      <td>373.660522</td>\n",
       "      <td>195.967804</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD28</th>\n",
       "      <td>0.274576</td>\n",
       "      <td>0.364751</td>\n",
       "      <td>0.187042</td>\n",
       "      <td>0.429406</td>\n",
       "      <td>0.396811</td>\n",
       "      <td>0.125420</td>\n",
       "      <td>0.374010</td>\n",
       "      <td>0.261919</td>\n",
       "      <td>0.323060</td>\n",
       "      <td>0.400113</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD15</th>\n",
       "      <td>11.647052</td>\n",
       "      <td>3.405212</td>\n",
       "      <td>12.111903</td>\n",
       "      <td>1.718820</td>\n",
       "      <td>5.436856</td>\n",
       "      <td>8.430137</td>\n",
       "      <td>23.184681</td>\n",
       "      <td>5.207158</td>\n",
       "      <td>2.906089</td>\n",
       "      <td>1.072730</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD45RA</th>\n",
       "      <td>2.809310</td>\n",
       "      <td>9.079441</td>\n",
       "      <td>5.926950</td>\n",
       "      <td>19.871086</td>\n",
       "      <td>9.039453</td>\n",
       "      <td>4.521348</td>\n",
       "      <td>10.214595</td>\n",
       "      <td>7.081024</td>\n",
       "      <td>8.205300</td>\n",
       "      <td>25.244133</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD66b</th>\n",
       "      <td>0.711640</td>\n",
       "      <td>0.398465</td>\n",
       "      <td>0.927381</td>\n",
       "      <td>0.232724</td>\n",
       "      <td>0.447859</td>\n",
       "      <td>0.943825</td>\n",
       "      <td>1.139344</td>\n",
       "      <td>0.591593</td>\n",
       "      <td>0.432269</td>\n",
       "      <td>0.286939</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD20</th>\n",
       "      <td>4.245859</td>\n",
       "      <td>9.033882</td>\n",
       "      <td>6.129274</td>\n",
       "      <td>68.748039</td>\n",
       "      <td>8.606109</td>\n",
       "      <td>4.270152</td>\n",
       "      <td>16.159504</td>\n",
       "      <td>6.945665</td>\n",
       "      <td>8.628428</td>\n",
       "      <td>50.045906</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD68</th>\n",
       "      <td>1.520188</td>\n",
       "      <td>2.675121</td>\n",
       "      <td>3.168860</td>\n",
       "      <td>1.195632</td>\n",
       "      <td>2.611720</td>\n",
       "      <td>3.739015</td>\n",
       "      <td>2.166785</td>\n",
       "      <td>3.080333</td>\n",
       "      <td>2.804429</td>\n",
       "      <td>1.683086</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD4</th>\n",
       "      <td>1.503492</td>\n",
       "      <td>3.443730</td>\n",
       "      <td>2.322971</td>\n",
       "      <td>2.202791</td>\n",
       "      <td>3.510501</td>\n",
       "      <td>1.845925</td>\n",
       "      <td>2.805830</td>\n",
       "      <td>2.964161</td>\n",
       "      <td>3.343019</td>\n",
       "      <td>2.601053</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD8</th>\n",
       "      <td>1.047831</td>\n",
       "      <td>3.696644</td>\n",
       "      <td>2.765355</td>\n",
       "      <td>1.137288</td>\n",
       "      <td>3.398115</td>\n",
       "      <td>2.219563</td>\n",
       "      <td>2.147879</td>\n",
       "      <td>3.305972</td>\n",
       "      <td>3.467887</td>\n",
       "      <td>1.574964</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD11c</th>\n",
       "      <td>12.348634</td>\n",
       "      <td>1.755015</td>\n",
       "      <td>1.466261</td>\n",
       "      <td>2.330095</td>\n",
       "      <td>1.869891</td>\n",
       "      <td>1.212658</td>\n",
       "      <td>3.400696</td>\n",
       "      <td>1.614732</td>\n",
       "      <td>1.881085</td>\n",
       "      <td>2.608520</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD45RO</th>\n",
       "      <td>11.859524</td>\n",
       "      <td>20.940781</td>\n",
       "      <td>15.421112</td>\n",
       "      <td>21.700232</td>\n",
       "      <td>21.267746</td>\n",
       "      <td>11.500840</td>\n",
       "      <td>21.159555</td>\n",
       "      <td>18.171213</td>\n",
       "      <td>19.908951</td>\n",
       "      <td>20.201859</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD3</th>\n",
       "      <td>3.070848</td>\n",
       "      <td>11.586220</td>\n",
       "      <td>7.243083</td>\n",
       "      <td>6.067876</td>\n",
       "      <td>12.042321</td>\n",
       "      <td>5.637224</td>\n",
       "      <td>9.046865</td>\n",
       "      <td>9.475895</td>\n",
       "      <td>10.564201</td>\n",
       "      <td>6.656618</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>IFNg</th>\n",
       "      <td>3.571129</td>\n",
       "      <td>4.709364</td>\n",
       "      <td>4.536445</td>\n",
       "      <td>7.107008</td>\n",
       "      <td>4.643734</td>\n",
       "      <td>4.265472</td>\n",
       "      <td>5.047030</td>\n",
       "      <td>4.585475</td>\n",
       "      <td>4.688526</td>\n",
       "      <td>6.148673</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TCF1</th>\n",
       "      <td>1.631392</td>\n",
       "      <td>3.359414</td>\n",
       "      <td>2.354661</td>\n",
       "      <td>2.221291</td>\n",
       "      <td>3.454602</td>\n",
       "      <td>1.884076</td>\n",
       "      <td>2.551759</td>\n",
       "      <td>2.669046</td>\n",
       "      <td>3.032099</td>\n",
       "      <td>1.855872</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD14</th>\n",
       "      <td>10.161412</td>\n",
       "      <td>9.815045</td>\n",
       "      <td>13.966036</td>\n",
       "      <td>8.697795</td>\n",
       "      <td>8.996326</td>\n",
       "      <td>17.640905</td>\n",
       "      <td>8.365284</td>\n",
       "      <td>12.136673</td>\n",
       "      <td>10.735606</td>\n",
       "      <td>7.937956</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD56</th>\n",
       "      <td>16.506502</td>\n",
       "      <td>11.700534</td>\n",
       "      <td>11.352810</td>\n",
       "      <td>10.901130</td>\n",
       "      <td>11.131175</td>\n",
       "      <td>11.812689</td>\n",
       "      <td>12.493258</td>\n",
       "      <td>11.210052</td>\n",
       "      <td>11.547062</td>\n",
       "      <td>11.038932</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>PD1</th>\n",
       "      <td>0.434041</td>\n",
       "      <td>0.619668</td>\n",
       "      <td>0.481901</td>\n",
       "      <td>2.319587</td>\n",
       "      <td>0.664347</td>\n",
       "      <td>0.454473</td>\n",
       "      <td>0.931258</td>\n",
       "      <td>0.547788</td>\n",
       "      <td>0.580809</td>\n",
       "      <td>0.978516</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD45</th>\n",
       "      <td>5.327374</td>\n",
       "      <td>7.063403</td>\n",
       "      <td>5.613504</td>\n",
       "      <td>9.247840</td>\n",
       "      <td>7.094888</td>\n",
       "      <td>4.831619</td>\n",
       "      <td>7.457782</td>\n",
       "      <td>6.266557</td>\n",
       "      <td>6.749026</td>\n",
       "      <td>9.342718</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>PNAd</th>\n",
       "      <td>0.588163</td>\n",
       "      <td>0.777306</td>\n",
       "      <td>3.884974</td>\n",
       "      <td>0.568924</td>\n",
       "      <td>0.691486</td>\n",
       "      <td>8.062602</td>\n",
       "      <td>0.617172</td>\n",
       "      <td>1.747507</td>\n",
       "      <td>0.993090</td>\n",
       "      <td>0.602114</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD31</th>\n",
       "      <td>2.550907</td>\n",
       "      <td>2.585679</td>\n",
       "      <td>4.236416</td>\n",
       "      <td>2.111810</td>\n",
       "      <td>2.429778</td>\n",
       "      <td>5.782395</td>\n",
       "      <td>2.294437</td>\n",
       "      <td>3.171049</td>\n",
       "      <td>2.729081</td>\n",
       "      <td>2.236870</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                     0           1           2           3           4  \\\n",
       "SMA           0.481423    1.309391    2.126096    0.579704    1.034955   \n",
       "ECadherin     5.337153    0.895151    0.917277    0.957158    1.015014   \n",
       "Cytokeratin  67.964310    8.256815    7.940267   12.393278    9.756522   \n",
       "HLADR         9.514902   25.786489   19.902126  100.617966   22.652782   \n",
       "Vimentin     26.117706  288.943787  613.416626   59.960083  207.838837   \n",
       "CD28          0.274576    0.364751    0.187042    0.429406    0.396811   \n",
       "CD15         11.647052    3.405212   12.111903    1.718820    5.436856   \n",
       "CD45RA        2.809310    9.079441    5.926950   19.871086    9.039453   \n",
       "CD66b         0.711640    0.398465    0.927381    0.232724    0.447859   \n",
       "CD20          4.245859    9.033882    6.129274   68.748039    8.606109   \n",
       "CD68          1.520188    2.675121    3.168860    1.195632    2.611720   \n",
       "CD4           1.503492    3.443730    2.322971    2.202791    3.510501   \n",
       "CD8           1.047831    3.696644    2.765355    1.137288    3.398115   \n",
       "CD11c        12.348634    1.755015    1.466261    2.330095    1.869891   \n",
       "CD45RO       11.859524   20.940781   15.421112   21.700232   21.267746   \n",
       "CD3           3.070848   11.586220    7.243083    6.067876   12.042321   \n",
       "IFNg          3.571129    4.709364    4.536445    7.107008    4.643734   \n",
       "TCF1          1.631392    3.359414    2.354661    2.221291    3.454602   \n",
       "CD14         10.161412    9.815045   13.966036    8.697795    8.996326   \n",
       "CD56         16.506502   11.700534   11.352810   10.901130   11.131175   \n",
       "PD1           0.434041    0.619668    0.481901    2.319587    0.664347   \n",
       "CD45          5.327374    7.063403    5.613504    9.247840    7.094888   \n",
       "PNAd          0.588163    0.777306    3.884974    0.568924    0.691486   \n",
       "CD31          2.550907    2.585679    4.236416    2.111810    2.429778   \n",
       "\n",
       "                      5           6           7           8           9  \n",
       "SMA            2.213308    0.709806    1.934577    1.527963    0.709294  \n",
       "ECadherin      0.994053    2.059105    0.894870    0.895395    0.903859  \n",
       "Cytokeratin    7.235658   21.381472    8.161931    8.062714   10.285240  \n",
       "HLADR         16.925838   31.314178   24.423939   27.201952  107.715370  \n",
       "Vimentin     854.635254  118.783218  474.137756  373.660522  195.967804  \n",
       "CD28           0.125420    0.374010    0.261919    0.323060    0.400113  \n",
       "CD15           8.430137   23.184681    5.207158    2.906089    1.072730  \n",
       "CD45RA         4.521348   10.214595    7.081024    8.205300   25.244133  \n",
       "CD66b          0.943825    1.139344    0.591593    0.432269    0.286939  \n",
       "CD20           4.270152   16.159504    6.945665    8.628428   50.045906  \n",
       "CD68           3.739015    2.166785    3.080333    2.804429    1.683086  \n",
       "CD4            1.845925    2.805830    2.964161    3.343019    2.601053  \n",
       "CD8            2.219563    2.147879    3.305972    3.467887    1.574964  \n",
       "CD11c          1.212658    3.400696    1.614732    1.881085    2.608520  \n",
       "CD45RO        11.500840   21.159555   18.171213   19.908951   20.201859  \n",
       "CD3            5.637224    9.046865    9.475895   10.564201    6.656618  \n",
       "IFNg           4.265472    5.047030    4.585475    4.688526    6.148673  \n",
       "TCF1           1.884076    2.551759    2.669046    3.032099    1.855872  \n",
       "CD14          17.640905    8.365284   12.136673   10.735606    7.937956  \n",
       "CD56          11.812689   12.493258   11.210052   11.547062   11.038932  \n",
       "PD1            0.454473    0.931258    0.547788    0.580809    0.978516  \n",
       "CD45           4.831619    7.457782    6.266557    6.749026    9.342718  \n",
       "PNAd           8.062602    0.617172    1.747507    0.993090    0.602114  \n",
       "CD31           5.782395    2.294437    3.171049    2.729081    2.236870  "
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## initial expression centriods (p x c) matrix\n",
    "pd.DataFrame(st.adata.varm[\"init_exp_centroids\"], index=st.adata.var_names)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "03424211",
   "metadata": {},
   "source": [
    "There are 10 centroids since we set Kmeans (KM) as k = 10 earlier.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f0bc41a8",
   "metadata": {},
   "source": [
    "## Showing Starling expression centriods:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "a11a5334",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "      <th>4</th>\n",
       "      <th>5</th>\n",
       "      <th>6</th>\n",
       "      <th>7</th>\n",
       "      <th>8</th>\n",
       "      <th>9</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>SMA</th>\n",
       "      <td>0.326149</td>\n",
       "      <td>0.712488</td>\n",
       "      <td>2.289810</td>\n",
       "      <td>0.648445</td>\n",
       "      <td>1.437518</td>\n",
       "      <td>2.698419</td>\n",
       "      <td>0.500520</td>\n",
       "      <td>0.667774</td>\n",
       "      <td>2.347505</td>\n",
       "      <td>0.831485</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ECadherin</th>\n",
       "      <td>5.522270</td>\n",
       "      <td>0.893311</td>\n",
       "      <td>0.967771</td>\n",
       "      <td>0.702459</td>\n",
       "      <td>1.416449</td>\n",
       "      <td>1.128502</td>\n",
       "      <td>4.662328</td>\n",
       "      <td>0.654967</td>\n",
       "      <td>0.788167</td>\n",
       "      <td>0.957973</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Cytokeratin</th>\n",
       "      <td>109.540916</td>\n",
       "      <td>6.996323</td>\n",
       "      <td>7.713223</td>\n",
       "      <td>8.725094</td>\n",
       "      <td>9.962206</td>\n",
       "      <td>8.033975</td>\n",
       "      <td>49.659325</td>\n",
       "      <td>6.500076</td>\n",
       "      <td>7.363036</td>\n",
       "      <td>8.508376</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>HLADR</th>\n",
       "      <td>4.203127</td>\n",
       "      <td>16.778210</td>\n",
       "      <td>11.952487</td>\n",
       "      <td>64.990593</td>\n",
       "      <td>25.203920</td>\n",
       "      <td>14.187275</td>\n",
       "      <td>12.846581</td>\n",
       "      <td>13.579684</td>\n",
       "      <td>20.612143</td>\n",
       "      <td>46.192272</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Vimentin</th>\n",
       "      <td>19.650230</td>\n",
       "      <td>334.947998</td>\n",
       "      <td>567.298767</td>\n",
       "      <td>178.533249</td>\n",
       "      <td>312.820282</td>\n",
       "      <td>675.612854</td>\n",
       "      <td>52.012482</td>\n",
       "      <td>298.594849</td>\n",
       "      <td>362.261017</td>\n",
       "      <td>383.508514</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD28</th>\n",
       "      <td>0.215896</td>\n",
       "      <td>0.340179</td>\n",
       "      <td>0.028124</td>\n",
       "      <td>0.444700</td>\n",
       "      <td>0.363145</td>\n",
       "      <td>0.095138</td>\n",
       "      <td>0.257389</td>\n",
       "      <td>0.109894</td>\n",
       "      <td>0.248940</td>\n",
       "      <td>0.991879</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD15</th>\n",
       "      <td>8.032538</td>\n",
       "      <td>0.880836</td>\n",
       "      <td>19.500408</td>\n",
       "      <td>0.349458</td>\n",
       "      <td>9.159814</td>\n",
       "      <td>12.177804</td>\n",
       "      <td>17.571045</td>\n",
       "      <td>0.976252</td>\n",
       "      <td>2.238995</td>\n",
       "      <td>0.560232</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD45RA</th>\n",
       "      <td>0.999976</td>\n",
       "      <td>6.828957</td>\n",
       "      <td>1.569541</td>\n",
       "      <td>16.214994</td>\n",
       "      <td>10.408425</td>\n",
       "      <td>3.298193</td>\n",
       "      <td>2.739264</td>\n",
       "      <td>4.872447</td>\n",
       "      <td>6.245378</td>\n",
       "      <td>9.806373</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD66b</th>\n",
       "      <td>0.230382</td>\n",
       "      <td>0.324594</td>\n",
       "      <td>0.618504</td>\n",
       "      <td>0.226765</td>\n",
       "      <td>0.615165</td>\n",
       "      <td>0.980740</td>\n",
       "      <td>0.417512</td>\n",
       "      <td>0.260921</td>\n",
       "      <td>0.341933</td>\n",
       "      <td>0.367371</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD20</th>\n",
       "      <td>1.486347</td>\n",
       "      <td>3.349393</td>\n",
       "      <td>1.546079</td>\n",
       "      <td>36.554585</td>\n",
       "      <td>8.142458</td>\n",
       "      <td>3.129491</td>\n",
       "      <td>3.294809</td>\n",
       "      <td>3.762761</td>\n",
       "      <td>6.254664</td>\n",
       "      <td>17.027361</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD68</th>\n",
       "      <td>1.265654</td>\n",
       "      <td>2.579655</td>\n",
       "      <td>2.233377</td>\n",
       "      <td>1.160019</td>\n",
       "      <td>4.124223</td>\n",
       "      <td>3.066004</td>\n",
       "      <td>1.529294</td>\n",
       "      <td>1.826001</td>\n",
       "      <td>2.390010</td>\n",
       "      <td>2.946590</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD4</th>\n",
       "      <td>0.829301</td>\n",
       "      <td>3.919131</td>\n",
       "      <td>1.020083</td>\n",
       "      <td>3.061506</td>\n",
       "      <td>4.010315</td>\n",
       "      <td>1.392021</td>\n",
       "      <td>1.530646</td>\n",
       "      <td>1.202402</td>\n",
       "      <td>2.667474</td>\n",
       "      <td>9.577381</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD8</th>\n",
       "      <td>0.760662</td>\n",
       "      <td>2.202145</td>\n",
       "      <td>0.953585</td>\n",
       "      <td>1.024207</td>\n",
       "      <td>3.438301</td>\n",
       "      <td>1.660465</td>\n",
       "      <td>0.894010</td>\n",
       "      <td>1.424433</td>\n",
       "      <td>3.682819</td>\n",
       "      <td>3.816618</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD11c</th>\n",
       "      <td>38.490746</td>\n",
       "      <td>1.214518</td>\n",
       "      <td>0.861894</td>\n",
       "      <td>1.279741</td>\n",
       "      <td>2.765768</td>\n",
       "      <td>1.068517</td>\n",
       "      <td>3.384927</td>\n",
       "      <td>0.599926</td>\n",
       "      <td>1.440130</td>\n",
       "      <td>4.252812</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD45RO</th>\n",
       "      <td>5.662930</td>\n",
       "      <td>19.896091</td>\n",
       "      <td>10.408895</td>\n",
       "      <td>23.330521</td>\n",
       "      <td>22.963661</td>\n",
       "      <td>11.552439</td>\n",
       "      <td>13.395853</td>\n",
       "      <td>10.725447</td>\n",
       "      <td>16.818832</td>\n",
       "      <td>52.992264</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD3</th>\n",
       "      <td>1.029394</td>\n",
       "      <td>12.774570</td>\n",
       "      <td>2.732516</td>\n",
       "      <td>10.164357</td>\n",
       "      <td>12.496589</td>\n",
       "      <td>4.149741</td>\n",
       "      <td>2.470531</td>\n",
       "      <td>4.369913</td>\n",
       "      <td>9.901228</td>\n",
       "      <td>28.153925</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>IFNg</th>\n",
       "      <td>2.616136</td>\n",
       "      <td>4.679460</td>\n",
       "      <td>4.040050</td>\n",
       "      <td>6.079391</td>\n",
       "      <td>5.782554</td>\n",
       "      <td>4.255188</td>\n",
       "      <td>4.138874</td>\n",
       "      <td>3.631847</td>\n",
       "      <td>4.151927</td>\n",
       "      <td>5.710649</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TCF1</th>\n",
       "      <td>1.178828</td>\n",
       "      <td>3.601135</td>\n",
       "      <td>1.763644</td>\n",
       "      <td>2.249256</td>\n",
       "      <td>4.625782</td>\n",
       "      <td>1.793723</td>\n",
       "      <td>1.544636</td>\n",
       "      <td>1.386437</td>\n",
       "      <td>2.501221</td>\n",
       "      <td>4.460977</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD14</th>\n",
       "      <td>12.073556</td>\n",
       "      <td>10.258222</td>\n",
       "      <td>14.365493</td>\n",
       "      <td>7.881569</td>\n",
       "      <td>12.897605</td>\n",
       "      <td>16.389851</td>\n",
       "      <td>9.120933</td>\n",
       "      <td>9.032832</td>\n",
       "      <td>11.159110</td>\n",
       "      <td>13.364243</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD56</th>\n",
       "      <td>17.281614</td>\n",
       "      <td>12.444674</td>\n",
       "      <td>10.600252</td>\n",
       "      <td>10.301925</td>\n",
       "      <td>17.615705</td>\n",
       "      <td>11.773481</td>\n",
       "      <td>16.092579</td>\n",
       "      <td>7.580405</td>\n",
       "      <td>10.653118</td>\n",
       "      <td>15.454822</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>PD1</th>\n",
       "      <td>0.239071</td>\n",
       "      <td>0.472215</td>\n",
       "      <td>0.344609</td>\n",
       "      <td>0.834451</td>\n",
       "      <td>0.628541</td>\n",
       "      <td>0.369281</td>\n",
       "      <td>0.357065</td>\n",
       "      <td>0.248036</td>\n",
       "      <td>0.437940</td>\n",
       "      <td>1.443430</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD45</th>\n",
       "      <td>4.301737</td>\n",
       "      <td>7.209684</td>\n",
       "      <td>3.800674</td>\n",
       "      <td>9.083422</td>\n",
       "      <td>9.755982</td>\n",
       "      <td>4.291219</td>\n",
       "      <td>6.160281</td>\n",
       "      <td>4.318205</td>\n",
       "      <td>5.713690</td>\n",
       "      <td>12.339664</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>PNAd</th>\n",
       "      <td>0.482502</td>\n",
       "      <td>0.631857</td>\n",
       "      <td>6.802348</td>\n",
       "      <td>0.577669</td>\n",
       "      <td>0.829989</td>\n",
       "      <td>9.748157</td>\n",
       "      <td>0.588081</td>\n",
       "      <td>0.551481</td>\n",
       "      <td>1.261166</td>\n",
       "      <td>0.795982</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CD31</th>\n",
       "      <td>2.545697</td>\n",
       "      <td>2.483634</td>\n",
       "      <td>6.613419</td>\n",
       "      <td>2.121925</td>\n",
       "      <td>3.614679</td>\n",
       "      <td>7.635912</td>\n",
       "      <td>2.593932</td>\n",
       "      <td>1.846803</td>\n",
       "      <td>2.874804</td>\n",
       "      <td>2.699292</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                      0           1           2           3           4  \\\n",
       "SMA            0.326149    0.712488    2.289810    0.648445    1.437518   \n",
       "ECadherin      5.522270    0.893311    0.967771    0.702459    1.416449   \n",
       "Cytokeratin  109.540916    6.996323    7.713223    8.725094    9.962206   \n",
       "HLADR          4.203127   16.778210   11.952487   64.990593   25.203920   \n",
       "Vimentin      19.650230  334.947998  567.298767  178.533249  312.820282   \n",
       "CD28           0.215896    0.340179    0.028124    0.444700    0.363145   \n",
       "CD15           8.032538    0.880836   19.500408    0.349458    9.159814   \n",
       "CD45RA         0.999976    6.828957    1.569541   16.214994   10.408425   \n",
       "CD66b          0.230382    0.324594    0.618504    0.226765    0.615165   \n",
       "CD20           1.486347    3.349393    1.546079   36.554585    8.142458   \n",
       "CD68           1.265654    2.579655    2.233377    1.160019    4.124223   \n",
       "CD4            0.829301    3.919131    1.020083    3.061506    4.010315   \n",
       "CD8            0.760662    2.202145    0.953585    1.024207    3.438301   \n",
       "CD11c         38.490746    1.214518    0.861894    1.279741    2.765768   \n",
       "CD45RO         5.662930   19.896091   10.408895   23.330521   22.963661   \n",
       "CD3            1.029394   12.774570    2.732516   10.164357   12.496589   \n",
       "IFNg           2.616136    4.679460    4.040050    6.079391    5.782554   \n",
       "TCF1           1.178828    3.601135    1.763644    2.249256    4.625782   \n",
       "CD14          12.073556   10.258222   14.365493    7.881569   12.897605   \n",
       "CD56          17.281614   12.444674   10.600252   10.301925   17.615705   \n",
       "PD1            0.239071    0.472215    0.344609    0.834451    0.628541   \n",
       "CD45           4.301737    7.209684    3.800674    9.083422    9.755982   \n",
       "PNAd           0.482502    0.631857    6.802348    0.577669    0.829989   \n",
       "CD31           2.545697    2.483634    6.613419    2.121925    3.614679   \n",
       "\n",
       "                      5          6           7           8           9  \n",
       "SMA            2.698419   0.500520    0.667774    2.347505    0.831485  \n",
       "ECadherin      1.128502   4.662328    0.654967    0.788167    0.957973  \n",
       "Cytokeratin    8.033975  49.659325    6.500076    7.363036    8.508376  \n",
       "HLADR         14.187275  12.846581   13.579684   20.612143   46.192272  \n",
       "Vimentin     675.612854  52.012482  298.594849  362.261017  383.508514  \n",
       "CD28           0.095138   0.257389    0.109894    0.248940    0.991879  \n",
       "CD15          12.177804  17.571045    0.976252    2.238995    0.560232  \n",
       "CD45RA         3.298193   2.739264    4.872447    6.245378    9.806373  \n",
       "CD66b          0.980740   0.417512    0.260921    0.341933    0.367371  \n",
       "CD20           3.129491   3.294809    3.762761    6.254664   17.027361  \n",
       "CD68           3.066004   1.529294    1.826001    2.390010    2.946590  \n",
       "CD4            1.392021   1.530646    1.202402    2.667474    9.577381  \n",
       "CD8            1.660465   0.894010    1.424433    3.682819    3.816618  \n",
       "CD11c          1.068517   3.384927    0.599926    1.440130    4.252812  \n",
       "CD45RO        11.552439  13.395853   10.725447   16.818832   52.992264  \n",
       "CD3            4.149741   2.470531    4.369913    9.901228   28.153925  \n",
       "IFNg           4.255188   4.138874    3.631847    4.151927    5.710649  \n",
       "TCF1           1.793723   1.544636    1.386437    2.501221    4.460977  \n",
       "CD14          16.389851   9.120933    9.032832   11.159110   13.364243  \n",
       "CD56          11.773481  16.092579    7.580405   10.653118   15.454822  \n",
       "PD1            0.369281   0.357065    0.248036    0.437940    1.443430  \n",
       "CD45           4.291219   6.160281    4.318205    5.713690   12.339664  \n",
       "PNAd           9.748157   0.588081    0.551481    1.261166    0.795982  \n",
       "CD31           7.635912   2.593932    1.846803    2.874804    2.699292  "
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## starling expression centriods (p x c) matrix\n",
    "pd.DataFrame(st.adata.varm[\"st_exp_centroids\"], index=st.adata.var_names)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a2cccf9d",
   "metadata": {},
   "source": [
    "From here one could easily annotate cluster centriods to cell type.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "993eb08b",
   "metadata": {},
   "source": [
    "## Showing Assignment Distributions:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "75f8b562",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "      <th>4</th>\n",
       "      <th>5</th>\n",
       "      <th>6</th>\n",
       "      <th>7</th>\n",
       "      <th>8</th>\n",
       "      <th>9</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>4_1</th>\n",
       "      <td>1.113865e-10</td>\n",
       "      <td>5.264620e-06</td>\n",
       "      <td>2.516918e-08</td>\n",
       "      <td>9.541354e-09</td>\n",
       "      <td>2.082846e-17</td>\n",
       "      <td>1.410759e-18</td>\n",
       "      <td>9.617835e-09</td>\n",
       "      <td>9.312990e-01</td>\n",
       "      <td>1.275393e-15</td>\n",
       "      <td>4.946894e-20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_2</th>\n",
       "      <td>1.285833e-12</td>\n",
       "      <td>4.559219e-01</td>\n",
       "      <td>3.993468e-05</td>\n",
       "      <td>8.624844e-03</td>\n",
       "      <td>7.427827e-13</td>\n",
       "      <td>1.459287e-15</td>\n",
       "      <td>7.324902e-07</td>\n",
       "      <td>2.703802e-01</td>\n",
       "      <td>1.466999e-10</td>\n",
       "      <td>8.923895e-13</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_3</th>\n",
       "      <td>8.933782e-19</td>\n",
       "      <td>1.680738e-13</td>\n",
       "      <td>9.817547e-01</td>\n",
       "      <td>6.278157e-18</td>\n",
       "      <td>3.019483e-19</td>\n",
       "      <td>1.835814e-12</td>\n",
       "      <td>1.671272e-13</td>\n",
       "      <td>4.093614e-10</td>\n",
       "      <td>3.552699e-17</td>\n",
       "      <td>5.236710e-22</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_4</th>\n",
       "      <td>6.753823e-09</td>\n",
       "      <td>3.635960e-06</td>\n",
       "      <td>5.880216e-07</td>\n",
       "      <td>8.840111e-07</td>\n",
       "      <td>6.167183e-18</td>\n",
       "      <td>6.442944e-16</td>\n",
       "      <td>8.980181e-05</td>\n",
       "      <td>9.255529e-01</td>\n",
       "      <td>8.516341e-15</td>\n",
       "      <td>8.427887e-18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_5</th>\n",
       "      <td>4.819373e-09</td>\n",
       "      <td>4.774594e-02</td>\n",
       "      <td>2.864405e-08</td>\n",
       "      <td>1.546968e-05</td>\n",
       "      <td>2.115557e-11</td>\n",
       "      <td>6.512540e-14</td>\n",
       "      <td>2.986656e-08</td>\n",
       "      <td>8.528239e-01</td>\n",
       "      <td>4.656289e-09</td>\n",
       "      <td>9.990017e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13681</th>\n",
       "      <td>1.318026e-07</td>\n",
       "      <td>6.869133e-12</td>\n",
       "      <td>1.236429e-08</td>\n",
       "      <td>2.839130e-15</td>\n",
       "      <td>3.862945e-13</td>\n",
       "      <td>8.793653e-16</td>\n",
       "      <td>9.405133e-01</td>\n",
       "      <td>1.908021e-10</td>\n",
       "      <td>3.212980e-16</td>\n",
       "      <td>4.997553e-20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13682</th>\n",
       "      <td>2.015888e-06</td>\n",
       "      <td>9.250998e-12</td>\n",
       "      <td>8.058909e-15</td>\n",
       "      <td>1.616779e-13</td>\n",
       "      <td>1.055600e-18</td>\n",
       "      <td>4.173725e-22</td>\n",
       "      <td>9.226938e-01</td>\n",
       "      <td>1.019577e-11</td>\n",
       "      <td>3.841519e-19</td>\n",
       "      <td>1.762351e-20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13683</th>\n",
       "      <td>1.464692e-11</td>\n",
       "      <td>2.885174e-05</td>\n",
       "      <td>1.192254e-03</td>\n",
       "      <td>1.018574e-06</td>\n",
       "      <td>1.798452e-19</td>\n",
       "      <td>5.618906e-16</td>\n",
       "      <td>1.272385e-06</td>\n",
       "      <td>9.195569e-01</td>\n",
       "      <td>2.865188e-15</td>\n",
       "      <td>2.730282e-19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13684</th>\n",
       "      <td>8.244882e-07</td>\n",
       "      <td>4.049017e-12</td>\n",
       "      <td>1.211718e-10</td>\n",
       "      <td>1.891516e-12</td>\n",
       "      <td>3.930970e-16</td>\n",
       "      <td>9.496104e-18</td>\n",
       "      <td>9.355499e-01</td>\n",
       "      <td>7.185550e-10</td>\n",
       "      <td>8.250338e-18</td>\n",
       "      <td>3.494605e-21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4_13685</th>\n",
       "      <td>2.037835e-07</td>\n",
       "      <td>1.197304e-01</td>\n",
       "      <td>1.816850e-01</td>\n",
       "      <td>9.308002e-04</td>\n",
       "      <td>9.209413e-10</td>\n",
       "      <td>6.355161e-12</td>\n",
       "      <td>9.196159e-03</td>\n",
       "      <td>3.186386e-02</td>\n",
       "      <td>1.991557e-10</td>\n",
       "      <td>7.268124e-11</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>13685 rows × 10 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                    0             1             2             3             4  \\\n",
       "4_1      1.113865e-10  5.264620e-06  2.516918e-08  9.541354e-09  2.082846e-17   \n",
       "4_2      1.285833e-12  4.559219e-01  3.993468e-05  8.624844e-03  7.427827e-13   \n",
       "4_3      8.933782e-19  1.680738e-13  9.817547e-01  6.278157e-18  3.019483e-19   \n",
       "4_4      6.753823e-09  3.635960e-06  5.880216e-07  8.840111e-07  6.167183e-18   \n",
       "4_5      4.819373e-09  4.774594e-02  2.864405e-08  1.546968e-05  2.115557e-11   \n",
       "...               ...           ...           ...           ...           ...   \n",
       "4_13681  1.318026e-07  6.869133e-12  1.236429e-08  2.839130e-15  3.862945e-13   \n",
       "4_13682  2.015888e-06  9.250998e-12  8.058909e-15  1.616779e-13  1.055600e-18   \n",
       "4_13683  1.464692e-11  2.885174e-05  1.192254e-03  1.018574e-06  1.798452e-19   \n",
       "4_13684  8.244882e-07  4.049017e-12  1.211718e-10  1.891516e-12  3.930970e-16   \n",
       "4_13685  2.037835e-07  1.197304e-01  1.816850e-01  9.308002e-04  9.209413e-10   \n",
       "\n",
       "                    5             6             7             8             9  \n",
       "4_1      1.410759e-18  9.617835e-09  9.312990e-01  1.275393e-15  4.946894e-20  \n",
       "4_2      1.459287e-15  7.324902e-07  2.703802e-01  1.466999e-10  8.923895e-13  \n",
       "4_3      1.835814e-12  1.671272e-13  4.093614e-10  3.552699e-17  5.236710e-22  \n",
       "4_4      6.442944e-16  8.980181e-05  9.255529e-01  8.516341e-15  8.427887e-18  \n",
       "4_5      6.512540e-14  2.986656e-08  8.528239e-01  4.656289e-09  9.990017e-14  \n",
       "...               ...           ...           ...           ...           ...  \n",
       "4_13681  8.793653e-16  9.405133e-01  1.908021e-10  3.212980e-16  4.997553e-20  \n",
       "4_13682  4.173725e-22  9.226938e-01  1.019577e-11  3.841519e-19  1.762351e-20  \n",
       "4_13683  5.618906e-16  1.272385e-06  9.195569e-01  2.865188e-15  2.730282e-19  \n",
       "4_13684  9.496104e-18  9.355499e-01  7.185550e-10  8.250338e-18  3.494605e-21  \n",
       "4_13685  6.355161e-12  9.196159e-03  3.186386e-02  1.991557e-10  7.268124e-11  \n",
       "\n",
       "[13685 rows x 10 columns]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "## assignment distributions (n x c maxtrix)\n",
    "pd.DataFrame(st.adata.obsm[\"assignment_prob_matrix\"], index=st.adata.obs.index)\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b203933c",
   "metadata": {},
   "source": [
    "Currently, we assign a cell label based on the maximum probability among all possible clusters. However, there could be mislabeled because maximum and second highest probabilies can be very close that the user might be interested.\n"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.15"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
